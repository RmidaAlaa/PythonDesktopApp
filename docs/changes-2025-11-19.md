# Changes — 2025-11-19

This document summarizes the modifications completed on 2025‑11‑19.

## Core — Device Detection and Management (`src/core/device_detector.py`)

- Normalized VID/PID handling:
  - Parse hex/decimal `vid`/`pid` strings into integers and format consistently.
  - Improved resilience when port metadata provides non‑standard formats.
- Robust unique ID derivation:
  - Prefer `uid` → `serial_number` → formatted `VID:PID` → `port_boardtype` fallback.
  - Arduino and UNKNOWN devices now get explicit, readable fallback UIDs.
- Expanded device information reading:
  - `STM32`: UID, firmware, hardware version, CPU frequency, flash size.
  - `ESP32/ESP8266`: chip ID, MAC, flash size, CPU frequency, firmware; chip ID used as UID when present.
  - `Arduino`: firmware and CPU frequency via simple serial probes.
  - `Generic`: best‑effort firmware probing and UID fallback.
- Device history persistence:
  - Load/save history to `%AppData%/device_history.json` with safe conversions.
  - Auto‑backup and recreate history file on JSON corruption.
  - Track `first_detected`, `last_seen`, `connection_count`, and `status`.
- Real‑time monitoring improvements:
  - Debounced loop that only reacts to actual set changes in connected devices.
  - Emits callbacks for `device_connected`/`device_disconnected` and updates history.
- Device templates:
  - Create, apply, delete templates; persisted in `%AppData%/device_templates.json`.
  - Templates capture full `device.to_dict()` for reproducible device profiles.
- Batch operations:
  - `update_info`, `add_tag`, `remove_tag`, `set_custom_name`, `add_notes` over multiple device IDs.
- Health scoring:
  - Simple heuristic combining connection, firmware, hardware info, and manufacturer completeness.
- Searching and statistics:
  - `search_devices(query, search_fields)` scans `custom_name`, `manufacturer`, `description`, `tags`, `notes`.
  - `get_device_statistics()` returns counts by connection state, board types, and manufacturers.
- `Device.to_dict()` formatting helpers:
  - Safe hex formatting for both integer and string inputs (`0xFFFF` style).

## Notes

- These changes enhance reliability of detection, provide structured persistence, and add utilities (search, stats, templates) leveraged by the GUI.
- If you plan to search by Machine ID in the UI, consider extending `search_devices` to include that field and wiring a Machine ID column in the search dialog.

## Affected Files

- `PythonDesktopApp/src/core/device_detector.py` (last write: 2025‑11‑19)

## Impact

- More stable device identification across platforms and boards.
- Easier troubleshooting and reporting via persisted history, templates, and statistics.
- Foundation for richer GUI features (device history, search, and health indicators).