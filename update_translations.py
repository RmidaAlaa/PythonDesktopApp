import xml.etree.ElementTree as ET
import sys

# Translations map (English Source -> French Target)
TRANSLATIONS = {
    "Close": "Fermer",
    "App data initialized successfully.": "Données de l'application initialisées avec succès.",
    "Warnings:": "Avertissements :",
    "Initialization": "Initialisation",
    "Settings Applied": "Paramètres appliqués",
    "Choose Your Theme & Language": "Choisissez votre thème et votre langue",
    "Apply Selection": "Appliquer la sélection",
    "Cancel": "Annuler",
    "Unknown": "Inconnu",
    "Location: Unknown": "Lieu : Inconnu",
    "AWG Kumulus Device Manager v1.0.0": "Gestionnaire de périphériques AWG Kumulus v1.0.0",
    "Filter devices": "Filtrer les appareils",
    "All": "Tous",
    "UID": "UID",
    "Firmware": "Firmware",
    "Settings": "Paramètres",
    "Themes & Language": "Thèmes et langue",
    "UserManual": "Manuel utilisateur",
    "Support": "Support",
    "Quick Tour": "Visite rapide",
    "Full name:": "Nom complet :",
    "Phone Number:": "Numéro de téléphone :",
    "Pays:": "Pays :",
    "Auto Flash": "Flash auto",
    "Enable Auto-Flash on Connect": "Activer le flash auto à la connexion",
    "Firmware .bin Path:": "Chemin du firmware (.bin) :",
    "Browse": "Parcourir",
    "Boards:": "Cartes :",
    "Save Auto-Flash Settings": "Enregistrer les paramètres Flash auto",
    "Enter client name": "Entrez le nom du client",
    "Client Name:": "Nom du client :",
    "Read UID": "Lire l'UID",
    "OpenProj": "Ouvrir Proj",
    "Select Firmware File": "Sélectionner le fichier firmware",
    "Auto-Flash settings saved": "Paramètres Flash auto enregistrés",
    "Scanning...": "Analyse...",
    "Check to load UID from board": "Cocher pour charger l'UID de la carte",
    "Click to copy. Right-click for options.": "Cliquez pour copier. Clic droit pour les options.",
    "Just now": "À l'instant",
    "Copied: {text}": "Copié : {text}",
    "Selected Device Details": "Détails de l'appareil sélectionné",
    "Board Type": "Type de carte",
    "Serial Number": "Numéro de série",
    "VID:PID": "VID:PID",
    "Manufacturer": "Fabricant",
    "Description": "Description",
    "Health Score": "Score de santé",
    "First Detected": "Détecté le",
    "Connections": "Connexions",
    "No additional info yet": "Pas d'info supplémentaire",
    "Additional Info:": "Info supplémentaire :",
    "Loading the UID of the board... Please wait.": "Chargement de l'UID de la carte... Veuillez patienter.",
    "Loading UID": "Chargement UID",
    "Working...": "Traitement...",
    "Report generated automatically": "Rapport généré automatiquement",
    "No Device": "Aucun appareil",
    "Please check or select a board from the table first.": "Veuillez d'abord cocher ou sélectionner une carte dans le tableau.",
    "Starting process...": "Démarrage du processus...",
    "Reading UID - DO NOT CLOSE": "Lecture UID - NE PAS FERMER",
    "OneDrive: On": "OneDrive : Activé",
    "OneDrive: Off": "OneDrive : Désactivé",
    "Welcome to AWG Kumulus": "Bienvenue sur AWG Kumulus",
    "Setup completed. You can open the README, USAGE guide, or the full user manual (English or French).": "Installation terminée. Vous pouvez ouvrir le README, le guide d'USAGE ou le manuel complet (Anglais ou Français).",
    "Open README": "Ouvrir README",
    "Open USAGE": "Ouvrir USAGE",
    "Manual (English)": "Manuel (Anglais)",
    "Manuel (Français)": "Manuel (Français)",
    "Open Project": "Ouvrir le projet",
    "STM32CubeIDE: Not found. Install it or set env var STM32CUBEIDE_BIN to the exe path.": "STM32CubeIDE : Introuvable. Installez-le ou définissez la var env STM32CUBEIDE_BIN.",
    "Where to clone on your laptop": "Où cloner sur votre ordinateur",
    "Workspace Folder:": "Dossier Workspace :",
    "Leave empty to use default workspace on same drive": "Laisser vide pour utiliser le workspace par défaut",
    "Select Workspace Folder": "Sélectionner le dossier Workspace",
    "Tip: If the selected folder lacks a .project file, I will auto-search up to two subfolders and import the first CubeIDE project found. You can also import manually in CubeIDE via File → Import → Existing Projects into Workspace.": "Astuce : Si le dossier manque de fichier .project, je chercherai dans les sous-dossiers. Vous pouvez aussi importer manuellement dans CubeIDE.",
    "After cloning, I will try to auto-import the project into the workspace using the same detection logic.": "Après clonage, je tenterai d'importer automatiquement le projet.",
    "Select Sub-Project": "Sélectionner le sous-projet",
    "Multiple CubeIDE projects were detected. Please select one:": "Plusieurs projets CubeIDE détectés. Veuillez en sélectionner un :",
    "Confirm Project Folder": "Confirmer le dossier du projet",
    "The selected folder already contains a CubeIDE project. Do you want to open this folder, or choose another?": "Le dossier contient déjà un projet. Voulez-vous l'ouvrir ou en choisir un autre ?",
    "Use This Folder": "Utiliser ce dossier",
    "Choose Another": "Choisir un autre",
    "Launching STM32CubeIDE...": "Lancement de STM32CubeIDE...",
    "Please Wait": "Veuillez patienter",
    "Confirm Destination": "Confirmer la destination",
    "The destination folder already contains files or a CubeIDE project. Do you want to use this folder for the new clone, or choose another?": "Le dossier de destination n'est pas vide. Voulez-vous l'utiliser ou en choisir un autre ?",
    "Cloning Repository": "Clonage du dépôt",
    "Running: git clone": "Exécution : git clone",
    "Copy Cell Value": "Copier la valeur",
    "Copy Row (CSV)": "Copier la ligne (CSV)",
    "Customize Device": "Personnaliser l'appareil",
    "View Firmware Backups": "Voir les sauvegardes firmware",
    "Device:": "Appareil :",
    "Custom Name:": "Nom personnalisé :",
    "Enter a custom name for this device": "Entrez un nom personnalisé",
    "Notes:": "Notes :",
    "Add notes about this device": "Ajouter des notes",
    "Health Score:": "Score de santé :",
    "Device customized successfully!": "Appareil personnalisé avec succès !",
    "Firmware Backups": "Sauvegardes Firmware",
    "No firmware backups available for this device.": "Aucune sauvegarde disponible.",
    "Date": "Date",
    "Version": "Version",
    "Reason": "Raison",
    "Size": "Taille",
    "Actions": "Actions",
    "Rollback": "Restaurer",
    "Delete": "Supprimer",
    "Confirm Rollback": "Confirmer la restauration",
    "Are you sure you want to rollback to this firmware version?\n\nA backup of the current firmware will be created first.": "Êtes-vous sûr de vouloir restaurer cette version ?\n\nUne sauvegarde du firmware actuel sera créée.",
    "Firmware rollback completed successfully!": "Restauration du firmware réussie !",
    "Firmware rollback failed!": "Échec de la restauration !",
    "Rollback error:": "Erreur de restauration :",
    "Confirm Delete": "Confirmer la suppression",
    "Are you sure you want to delete this backup?\n\nThis action cannot be undone.": "Voulez-vous supprimer cette sauvegarde ?\n\nCette action est irréversible.",
    "Backup deleted successfully!": "Sauvegarde supprimée !",
    "Delete error:": "Erreur de suppression :",
    "Loading microcontroller UID...": "Chargement de l'UID...",
    "Git clone failed or was cancelled": "Clonage Git échoué ou annulé",
    "Config": "Config",
    "Machine Configuration": "Configuration Machine",
    "Initialize App Data": "Initialiser Données App",
    "Select Project Folder": "Sélectionner le dossier du projet",
    "Select Destination Folder": "Sélectionner le dossier de destination",
    "Please select a project folder": "Veuillez sélectionner un dossier de projet",
    "Selected folder does not exist": "Le dossier sélectionné n'existe pas",
    "Please provide both Git URL and destination": "Veuillez fournir l'URL Git et le dossier de destination",
    "Please install Git and ensure it is in PATH": "Veuillez installer Git et l'ajouter au PATH",
    "Repository cloned successfully": "Dépôt cloné avec succès",
    "Next": "Suivant",
    "Skip": "Passer",
    "Finish": "Terminer",
    "This quick tour will guide you through all features and components of the application.": "Cette visite rapide vous guidera à travers toutes les fonctionnalités de l'application.",
    "Device List": "Liste des appareils",
    "All connected devices appear here. You can see Port, Type, UID, Firmware, and Status.": "Tous les appareils connectés apparaissent ici. Vous pouvez voir Port, Type, UID, Firmware et État.",
    "Filter Devices": "Filtrer les appareils",
    "Type here to filter devices by name, port, or type.": "Tapez ici pour filtrer par nom, port ou type.",
    "Filter by Type": "Filtrer par type",
    "Use this dropdown to view only specific board types (e.g., STM32).": "Utilisez ce menu pour voir uniquement certains types de cartes (ex. STM32).",
    "Operator Name": "Nom de l'opérateur",
    "Enter your full name here. This will be included in reports and emails.": "Entrez votre nom complet ici. Il sera inclus dans les rapports et emails.",
    "Operator Email": "Email de l'opérateur",
    "Provide your email address for support requests and report identification.": "Fournissez votre email pour le support et l'identification des rapports.",
    "Phone Number": "Numéro de téléphone",
    "Enter your contact number.": "Entrez votre numéro de contact.",
    "Country (Pays)": "Pays",
    "This is auto-detected, but you can correct it if needed.": "Détecté automatiquement, mais vous pouvez le corriger si nécessaire.",
    "Client Name": "Nom du client",
    "MANDATORY: Enter the client name. Reports and emails cannot be sent without this.": "OBLIGATOIRE : Entrez le nom du client. Les rapports ne peuvent pas être envoyés sans.",
    "Machine Type": "Type de machine",
    "Select the type of machine you are working on (e.g., Amphore).": "Sélectionnez le type de machine (ex. Amphore).",
    "Machine ID": "ID Machine",
    "Select or type the ID suffix. The full ID (Prefix + Suffix) is shown above.": "Sélectionnez ou tapez le suffixe. L'ID complet est affiché au-dessus.",
    "Refresh Devices": "Rafraîchir les appareils",
    "Click to re-scan for connected devices. UIDs are cleared on refresh.": "Cliquez pour rescanner. Les UID sont effacés au rafraîchissement.",
    "Device History": "Historique des appareils",
    "View a log of all devices detected in this session.": "Voir l'historique des appareils détectés dans cette session.",
    "Send Email": "Envoyer un email",
    "Send the generated report to configured recipients via SMTP or Azure.": "Envoyer le rapport généré aux destinataires configurés via SMTP ou Azure.",
    "Flash Firmware": "Flasher le firmware",
    "Open the flashing dialog to update device firmware or restore backups.": "Ouvrir le dialogue de flashage pour mettre à jour ou restaurer.",
    "Manually read the Unique ID of a selected device.": "Lire manuellement l'Identifiant Unique d'un appareil sélectionné.",
    "Quickly open the STM32 project folder or VS Code workspace.": "Ouvrir rapidement le dossier projet STM32 ou le workspace VS Code.",
    "Configure Email, OneDrive, App Defaults, and Initialize App Data.": "Configurer Email, OneDrive, défauts et initialiser les données.",
    "User Manual": "Manuel utilisateur",
    "Click here to open the full User Manual (PDF/HTML).": "Cliquez ici pour ouvrir le manuel complet (PDF/HTML).",
    "Contact Support": "Contacter le support",
    "Need help? Click here to send logs and a description to support.": "Besoin d'aide ? Cliquez pour envoyer des logs au support.",
    "OneDrive Status": "État OneDrive",
    "Shows the current status of OneDrive sync.": "Affiche l'état actuel de la synchro OneDrive.",
    "Connected Devices": "Appareils connectés",
    "Total count of currently connected devices.": "Nombre total d'appareils connectés.",
    "System Time": "Heure système",
    "Current date and time with UTC offset.": "Date et heure actuelles avec décalage UTC.",
    "Location & Timezone": "Lieu et fuseau horaire",
    "Detected location and timezone information.": "Informations de lieu et fuseau horaire détectées.",
    "Restart Tour": "Redémarrer la visite",
    "Click this icon anytime to restart the quick tour.": "Cliquez sur cette icône pour redémarrer la visite.",
    "Tour Complete": "Visite terminée",
    "You are all set! Click Finish to start using the app.": "Vous êtes prêt ! Cliquez sur Terminer pour utiliser l'application.",
    "{} min ago": "il y a {} min",
    "{} h ago": "il y a {} h",
    "Never": "Jamais",
    "Select Firmware File": "Sélectionner le fichier firmware",
    "Firmware Files (*.bin *.elf);;Binary Files (*.bin);;ELF Files (*.elf);;All Files (*)": "Fichiers Firmware (*.bin *.elf);;Fichiers Binaires (*.bin);;Fichiers ELF (*.elf);;Tous les fichiers (*)",
    "Email Configuration": "Configuration Email",
    "OneDrive is currently disabled": "OneDrive est actuellement désactivé",
    "Email Provider": "Fournisseur de messagerie",
    "Provider:": "Fournisseur :",
    "Email Address:": "Adresse email :",
    "Azure Configuration": "Configuration Azure",
    "Client ID:": "ID Client :",
    "Tenant ID:": "ID Locataire :",
    "Client Secret:": "Secret Client :",
    "Sender Email:": "Email de l'expéditeur :",
    "Auto-detect Settings": "Détection auto des paramètres",
    "SMTP Configuration": "Configuration SMTP",
    "SMTP Server:": "Serveur SMTP :",
    "Port:": "Port :",
    "Use TLS/STARTTLS": "Utiliser TLS/STARTTLS",
    "Security:": "Sécurité :",
    "Password:": "Mot de passe :",
    "Recipients": "Destinataires",
    "Enter email addresses, one per line": "Entrez les adresses email, une par ligne",
    "[GUIDE] Email Configuration Guide": "[GUIDE] Guide de configuration Email",
    "Select an email provider to see specific configuration instructions": "Sélectionnez un fournisseur pour voir les instructions spécifiques",
    "Test Configuration": "Tester la configuration",
    "Missing Info": "Information manquante",
    "Please add at least one recipient.": "Veuillez ajouter au moins un destinataire.",
    "Please fill in all Azure configuration fields.": "Veuillez remplir tous les champs de configuration Azure.",
    "Please enter a Sender Email.": "Veuillez entrer un email d'expéditeur.",
    "Sending test email via Azure...": "Envoi de l'email de test via Azure...",
    "Test Email from AWG Kumulus (Azure)": "Email de test de AWG Kumulus (Azure)",
    "This is a test email to verify your Azure Graph API configuration.": "Ceci est un email de test pour vérifier votre configuration Azure Graph API.",
    "Success": "Succès",
    "Test email sent successfully via Azure!": "Email de test envoyé avec succès via Azure !",
    "Failed": "Échec",
    "Failed to send test email.\n\nNote: Ensure 'Sender Email' is a valid user email address in your Azure tenant, not an application name.": "Échec de l'envoi de l'email de test.\n\nNote : Assurez-vous que 'Email de l'expéditeur' est une adresse email utilisateur valide dans votre locataire Azure, pas un nom d'application.",
    "Please fill in Host, Port, and Email Address.": "Veuillez remplir Hôte, Port et Adresse email.",
    "Invalid Port": "Port invalide",
    "Port must be a number.": "Le port doit être un nombre.",
    "Sending test email...": "Envoi de l'email de test...",
    "Test Email from AWG Kumulus": "Email de test de AWG Kumulus",
    "This is a test email to verify your SMTP configuration.": "Ceci est un email de test pour vérifier votre configuration SMTP.",
    "Test email sent successfully!": "Email de test envoyé avec succès !",
    "Failed to send test email. Check logs.": "Échec de l'envoi de l'email de test. Vérifiez les logs.",
    "No Email": "Pas d'email",
    "Please enter your email address first.": "Veuillez d'abord entrer votre adresse email.",
    "Invalid Email": "Email invalide",
    "Please enter a valid email address.": "Veuillez entrer une adresse email valide.",
    "Custom Domain": "Domaine personnalisé",
    "Domain '{}' not recognized. Please configure manually or choose 'Custom'.": "Domaine '{}' non reconnu. Veuillez configurer manuellement ou choisir 'Personnalisé'.",
    "Select Firmware:": "Sélectionner le firmware :",
    "Source Type:": "Type de source :",
    "Local File (.bin/.elf)": "Fichier local (.bin/.elf)",
    "URL Download": "Téléchargement URL",
    "GitLab Repository": "Dépôt GitLab",
    "Select firmware file or enter URL...": "Sélectionner un fichier firmware ou entrer une URL...",
    "Erase flash before flashing": "Effacer la mémoire flash avant le flashage",
    "Verify flash after completion": "Vérifier le flash après la fin",
    "Boot Mode:": "Mode de démarrage :",
    "Normal Boot": "Démarrage normal",
    "Bootloader Mode": "Mode Bootloader",
    "Auto-detect": "Détection auto",
    "Select Device": "Sélectionner l'appareil",
    "Choose device to flash:": "Choisir l'appareil à flasher :",
    "Firmware Source": "Source du firmware",
    "Flash Options": "Options de flash",
    "Firmware flashing failed. Please check connection.": "Le flashage du firmware a échoué. Veuillez vérifier la connexion.",
    "Communication error: {}": "Erreur de communication : {}",
    "Could not retrieve UID from device response.": "Impossible de récupérer l'UID depuis la réponse de l'appareil.",
    "Step 1/3: Flashing firmware... (Do not unplug)": "Étape 1/3 : Flashage du firmware... (Ne pas débrancher)",
    "Step 1/3: {}": "Étape 1/3 : {}",
    "Step 2/3: Rebooting device... (Please wait)": "Étape 2/3 : Redémarrage de l'appareil... (Veuillez patienter)",
    "Step 3/3: Connecting to {}...": "Étape 3/3 : Connexion à {}...",
    "Step 3/3: Reading data (Attempt {})...": "Étape 3/3 : Lecture des données (Tentative {})...",
    """
        <b>[BOARD] Board-Specific Requirements:</b><br>
        • <b>STM32:</b> Requires STM32CubeProgrammer or OpenOCD<br>
        • <b>Arduino:</b> Uses avrdude for AVR-based boards<br>
        • <b>Generic:</b> Basic serial communication support
        """: """
        <b>[CARTE] Exigences Spécifiques :</b><br>
        • <b>STM32 :</b> Nécessite STM32CubeProgrammer ou OpenOCD<br>
        • <b>Arduino :</b> Utilise avrdude pour les cartes AVR<br>
        • <b>Générique :</b> Support basique de la communication série
        """,
    """
        <b>[TROUBLESHOOTING] Firmware Flashing Troubleshooting:</b><br>
        • <b>Device not found:</b> Check USB connection and drivers<br>
        • <b>Permission denied:</b> Run as administrator (Windows) or use sudo (Linux)<br>
        • <b>Flash failed:</b> Put device in bootloader mode manually<br>
        • <b>Wrong file format:</b> Ensure file matches board type<br>
        • <b>Still having issues?</b> Check: <a href="https://www.st.com/en/development-tools/stm32cubeprog.html">STM32 Docs</a>
        """: """
        <b>[DÉPANNAGE] Problèmes de Flashage Firmware :</b><br>
        • <b>Appareil non trouvé :</b> Vérifiez la connexion USB et les pilotes<br>
        • <b>Permission refusée :</b> Exécutez en tant qu'administrateur (Windows) ou sudo (Linux)<br>
        • <b>Échec du flash :</b> Mettez l'appareil en mode bootloader manuellement<br>
        • <b>Format de fichier incorrect :</b> Assurez-vous que le fichier correspond au type de carte<br>
        • <b>Toujours des problèmes ?</b> Voir : <a href="https://www.st.com/en/development-tools/stm32cubeprog.html">Docs STM32</a>
        """,
    # Firmware Flasher
    "Downloading firmware from {}...": "Téléchargement du firmware depuis {}...",
    "Downloading: {:.1f}%": "Téléchargement : {:.1f}%",
    "Download failed: {}": "Échec du téléchargement : {}",
    "Firmware downloaded to {}": "Firmware téléchargé vers {}",
    "Download failed: Status code {}": "Échec du téléchargement : Code statut {}",
    "Download failed: Content-Type is not binary": "Échec du téléchargement : Le type de contenu n'est pas binaire",
    "Preparing STM32 flash...": "Préparation du flashage STM32...",
    "Error: Unsupported file format: {}": "Erreur : Format de fichier non supporté : {}",
    "Error: No STM32 flashing tool found. Please install STM32CubeProgrammer or dfu-util": "Erreur : Aucun outil de flashage STM32 trouvé. Veuillez installer STM32CubeProgrammer ou dfu-util",
    "Converting ELF to binary...": "Conversion ELF vers binaire...",
    "Error: ELF conversion failed: {}": "Erreur : La conversion ELF a échoué : {}",
    "Flashing STM32 with STM32CubeProgrammer...": "Flashage STM32 avec STM32CubeProgrammer...",
    "Error: STM32CubeProgrammer failed": "Erreur : Échec de STM32CubeProgrammer",
    "Downloading firmware...": "Téléchargement du firmware...",
    "Validating firmware...": "Validation du firmware...",
    "Firmware validation failed: {}": "Échec de la validation du firmware : {}",
    "Backing up current firmware...": "Sauvegarde du firmware actuel...",
    "Flashing firmware...": "Flashage du firmware...",
    "Flashing failed, restoring backup...": "Échec du flashage, restauration de la sauvegarde...",
    "Adding firmware from GitHub...": "Ajout du firmware depuis GitHub...",
    "Flashing firmware (ID: {})...": "Flashage du firmware (ID: {})...",
    "Backup created at {}": "Sauvegarde créée à {}",
    "Backup failed: {}": "Échec de la sauvegarde : {}",
    "Flashing failed: {}": "Échec du flashage : {}",
    "Flashing successful!": "Flashage réussi !",
    "Rolling back to {}...": "Restauration vers {}...",
    "Rollback failed, restoring current firmware...": "Échec de la restauration, rétablissement du firmware actuel...",
    "STM32 Cube Programmer not found": "STM32 Cube Programmer introuvable",
    "Flashing with STM32 Cube Programmer...": "Flashage avec STM32 Cube Programmer...",
    "Verification failed": "Échec de la vérification",
    "Flashing failed": "Échec du flashage",
    "Flashing complete (verified)": "Flashage terminé (vérifié)",
    "Flashing complete": "Flashage terminé",
    # Email Sender
    "Missing Azure config fields: {}": "Champs de configuration Azure manquants : {}",
    "Authenticating with Azure...": "Authentification avec Azure...",
    "Preparing email...": "Préparation de l'email...",
    "Sending via Graph API...": "Envoi via l'API Graph...",
    "No sender email provided in Azure config": "Aucun email d'expéditeur fourni dans la config Azure",
    "Azure Error: {}": "Erreur Azure : {}",
    "Connecting to SMTP server...": "Connexion au serveur SMTP...",
    "Logging in...": "Connexion...",
    "Sending email...": "Envoi de l'email...",
    "Email sent successfully!": "Email envoyé avec succès !",
    "Error: {}": "Erreur : {}",
    "Password not found (neither provided nor in keyring)": "Mot de passe introuvable (ni fourni ni dans le trousseau)",
    "No recipients provided": "Aucun destinataire fourni",
    "Failed to obtain access token: {}": "Échec de l'obtention du jeton d'accès : {}",

    "Downloading firmware from {}...": "Téléchargement du firmware depuis {}...",
    "Downloading: {:.1f}%": "Téléchargement : {:.1f}%",
    "Preparing STM32 flash...": "Préparation du flash STM32...",
    "Error: Unsupported file format: {}": "Erreur : Format de fichier non pris en charge : {}",
    "Error: No STM32 flashing tool found. Please install STM32CubeProgrammer or dfu-util": "Erreur : Aucun outil de flash STM32 trouvé. Installez STM32CubeProgrammer ou dfu-util",
    "Converting ELF to binary...": "Conversion ELF en binaire...",
    "Error: ELF conversion failed: {}": "Erreur : Échec de la conversion ELF : {}",
    "Flashing STM32 with STM32CubeProgrammer...": "Flashage STM32 avec STM32CubeProgrammer...",
    "Error: STM32CubeProgrammer failed": "Erreur : STM32CubeProgrammer a échoué",
    "Downloading firmware...": "Téléchargement du firmware...",
    "Validating firmware...": "Validation du firmware...",
    "Backing up current firmware...": "Sauvegarde du firmware actuel...",
    "Flashing firmware...": "Flashage du firmware...",
    "Flashing failed, restoring backup...": "Le flashage a échoué, restauration de la sauvegarde...",
    "Adding firmware from GitHub...": "Ajout du firmware depuis GitHub...",
    "Adding firmware from GitLab...": "Ajout du firmware depuis GitLab...",
    "Adding firmware from URL...": "Ajout du firmware depuis l'URL...",
    "Firmware validation failed: {}": "Échec de la validation du firmware : {}",
    "Rolling back to {}...": "Restauration vers {}...",
    "Rollback failed, restoring current firmware...": "La restauration a échoué, rétablissement du firmware actuel...",
    "Restoring firmware backup...": "Restauration de la sauvegarde firmware...",
    "No firmware backups available": "Aucune sauvegarde firmware disponible",
    "Backup index {} out of range": "Index de sauvegarde {} hors limites",

    # Firmware Manager
    "Downloading {}...": "Téléchargement de {}...",
    "Downloading {}... {}%": "Téléchargement de {}... {}%",
    "Downloaded {} successfully": "{} téléchargé avec succès",
    "Firmware not found": "Firmware non trouvé",
    "Firmware file not found": "Fichier firmware non trouvé",
    "Firmware file not found: {}": "Fichier firmware non trouvé : {}",
    "Firmware {} not found": "Firmware {} non trouvé",
    "No download URL available": "Aucune URL de téléchargement disponible",
    "Repository must be in format 'owner/repo'": "Le dépôt doit être au format 'owner/repo'",
    "No suitable firmware asset found in release": "Aucun fichier firmware approprié trouvé dans la release",
    "No successful pipelines found": "Aucun pipeline réussi trouvé",
    "No suitable firmware job found in pipeline": "Aucun job firmware approprié trouvé dans le pipeline",
    "Checksum mismatch. Expected: {}, Got: {}": "Erreur de somme de contrôle. Attendu : {}, Reçu : {}",
    "File size mismatch. Expected: {}, Got: {}": "Erreur de taille de fichier. Attendu : {}, Reçu : {}",
    "Firmware validation passed": "Validation du firmware réussie",
    "Validation error: {}": "Erreur de validation : {}",

    # Report Generator
    "Metadata": "Métadonnées",
    "Devices": "Appareils",
    "Property": "Propriété",
    "Value": "Valeur",
    "Timestamp": "Horodatage",
    "Application": "Application",
    "Version": "Version",
    "Operator Name": "Nom de l'opérateur",
    "Operator Email": "Email de l'opérateur",
    "Client Name": "Nom du client",
    "Machine Type": "Type de machine",
    "Machine ID": "ID Machine",
    "PC Name": "Nom du PC",
    "PC OS": "OS du PC",
    "Platform": "Plateforme",
    "Board Type": "Type de carte",
    "Port": "Port",
    "VID": "VID",
    "PID": "PID",
    "Chip ID": "ID Puce",
    "MAC Address": "Adresse MAC",
    "Manufacturer": "Fabricant",
    "Serial Number": "Numéro de série",
    "Firmware Version": "Version Firmware",
    "Hardware Version": "Version Matériel",
    "Flash Size": "Taille Flash",
    "CPU Frequency": "Fréquence CPU",
    "N/A": "N/D",
    "Sheet": "Feuille",
}

def update_ts_file(file_path):
    try:
        tree = ET.parse(file_path)
        root = tree.getroot()
        
        updated_count = 0
        
        for context in root.findall('context'):
            for message in context.findall('message'):
                source = message.find('source')
                translation = message.find('translation')
                
                if source is not None and translation is not None:
                    source_text = source.text
                    
                    if source_text in TRANSLATIONS:
                        # Check if unfinished or empty
                        if translation.get('type') == 'unfinished' or not translation.text:
                            translation.text = TRANSLATIONS[source_text]
                            if 'type' in translation.attrib:
                                del translation.attrib['type']
                            updated_count += 1
        
        tree.write(file_path, encoding='utf-8', xml_declaration=True)
        print(f"Updated {updated_count} translations in {file_path}")
        return True
    except Exception as e:
        print(f"Error updating {file_path}: {e}")
        return False

if __name__ == "__main__":
    ts_file = "translations/app_fr.ts"
    update_ts_file(ts_file)
