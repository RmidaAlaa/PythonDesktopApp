<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Language Selector Preview</title>
    <style>
      body { font-family: system-ui, Arial, sans-serif; background: #1e1e1e; color: #ddd; margin: 0; }
      header { padding: 16px 24px; background: #2b2b2b; border-bottom: 1px solid #3a3a3a; }
      main { padding: 24px; max-width: 800px; margin: 0 auto; }
      .card { background: #2b2b2b; border: 1px solid #3a3a3a; border-radius: 8px; padding: 16px; margin-bottom: 16px; }
      .row { display: flex; gap: 12px; align-items: center; }
      select { background: #3a3a3a; color: #fff; border: 1px solid #4a4a4a; border-radius: 6px; padding: 8px 12px; }
      .note { font-size: 13px; color: #aaa; }
      .badge { display: inline-block; padding: 4px 8px; border-radius: 4px; background: #6f42c1; color: #fff; font-size: 12px; }
      .footerbar { position: sticky; bottom: 0; background:#262626; border-top:1px solid #3a3a3a; padding:8px 12px; display:flex; gap:16px; align-items:center; font-size:13px; color:#bbb; }
      .footer-middle { display:flex; gap:12px; align-items:center; }
      .footer-right { margin-left:auto; }
    </style>
  </head>
  <body>
    <header>
      <div style="display:flex; align-items:center; justify-content:space-between; gap:12px">
        <h1 style="margin:0">AWG Kumulus Desktop ‚Äì Language Options</h1>
        <div>
          <a href="manual_en.html" style="background:#3b82f6; color:#fff; text-decoration:none; padding:8px 12px; border-radius:6px;">Help (English)</a>
          <a href="manual_fr.html" style="background:#10b981; color:#fff; text-decoration:none; padding:8px 12px; border-radius:6px; margin-left:8px;">Aide (Fran√ßais)</a>
        </div>
      </div>
    </header>
    <main>
      <div class="card">
        <div class="row">
          <label for="lang">Language:</label>
          <select id="lang">
            <option value="en">English</option>
            <option value="fr">Fran√ßais</option>
          </select>
          <span class="badge">Arabic removed</span>
        </div>
        <p class="note">This preview reflects app changes: only English and French are available. RTL layout is disabled.</p>
      </div>

      <div class="card">
        <h3 style="margin-top:0">Footer: Timezone & Location (Preview)</h3>
        <p class="note">The app shows your local timezone and approximate location in the status bar footer.</p>
        <div id="footerPreview" class="footerbar">
          <span id="devices">üîå Devices found: 0</span>
          <div class="footer-middle">
            <span id="clock">üïí detecting‚Ä¶</span>
            <span id="tz">üåê detecting‚Ä¶</span>
            <span id="loc">üìç detecting‚Ä¶</span>
          </div>
          <div class="footer-right">
            <select id="langFooter">
              <option value="en">English</option>
              <option value="fr">Fran√ßais</option>
            </select>
          </div>
        </div>
        <script>
          (function(){
            const clockEl = document.getElementById('clock');
            const tzEl = document.getElementById('tz');
            const locEl = document.getElementById('loc');
            // Timezone from browser
            try {
              const tz = Intl.DateTimeFormat().resolvedOptions().timeZone || 'Unknown';
              tzEl.textContent = 'üåê ' + tz;
            } catch(e){ tzEl.textContent = 'üåê Unknown'; }

            // Localized date/time with UTC offset
            function updateClock(){
              const now = new Date();
              const dt = new Intl.DateTimeFormat(navigator.language, { dateStyle: 'medium', timeStyle: 'short' }).format(now);
              const offsetMin = -now.getTimezoneOffset();
              const sign = offsetMin >= 0 ? '+' : '-';
              const hh = String(Math.floor(Math.abs(offsetMin)/60)).padStart(2,'0');
              const mm = String(Math.abs(offsetMin)%60).padStart(2,'0');
              const off = `UTC${sign}${hh}:${mm}`;
              clockEl.textContent = `üïí ${dt} ¬∑ ${off}`;
            }
            updateClock();
            setInterval(updateClock, 1000);
            // Location from IP (best effort)
            fetch('https://ipapi.co/json/').then(r=>r.json()).then(j=>{
              const city = j.city || j.region || 'Unknown';
              const country = j.country_name || j.country || 'Unknown';
              locEl.textContent = 'üìç ' + city + ', ' + country;
            }).catch(()=>{
              // Fallback
              locEl.textContent = 'üìç Unknown';
            });
          })();
        </script>
      </div>
      <div class="card">
        <h3 style="margin-top:0">What changed</h3>
        <ul>
          <li>Removed Arabic from language manager and dialog.</li>
          <li>Updated status bar selector to only English/French.</li>
          <li>Deleted Arabic Qt translation file and build target.</li>
        </ul>
      </div>
      <div class="card">
        <h3 style="margin-top:0">STM32CubeIDE Detection</h3>
        <p class="note">The "Open STM32 Project" dialog now shows installation status before launching the IDE.</p>
        <div class="row" style="gap:8px">
          <span style="color:#2e7d32">Example (found):</span>
          <code>STM32CubeIDE: Found at C:\\Program Files\\STMicroelectronics\\STM32CubeIDE\\STM32CubeIDE.exe (via registry)</code>
        </div>
        <div class="row" style="gap:8px; margin-top:8px">
          <span style="color:#c62828">Example (not found):</span>
          <code>STM32CubeIDE: Not found. Install it or set env var STM32CUBEIDE_BIN to the exe path.</code>
        </div>
        <p class="note">Detection checks environment variables, Windows Registry, common install paths, then PATH.</p>
      </div>

      <div class="card">
        <h3 style="margin-top:0">Open STM32 Project (Preview)</h3>
        <div class="row">
          <label><input type="radio" name="mode" value="local" checked> Use local project path</label>
          <label><input type="radio" name="mode" value="git"> Clone from Git URL</label>
        </div>
        <div class="row" style="margin-top:8px">
          <label>Workspace Folder:</label>
          <input id="ws" type="text" placeholder="Leave empty to use default workspace on same drive" style="flex:1; background:#3a3a3a; color:#fff; border:1px solid #4a4a4a; border-radius:6px; padding:8px 12px;">
          <button id="wsPick" style="background:#444; color:#fff; border:1px solid #555; border-radius:6px; padding:8px 12px;">Select</button>
        </div>
        <div id="local" style="margin-top:10px">
          <div class="row">
            <label>Project Folder:</label>
            <input id="localPath" type="text" placeholder="Select a folder containing the project" style="flex:1; background:#3a3a3a; color:#fff; border:1px solid #4a4a4a; border-radius:6px; padding:8px 12px;">
            <button style="background:#444; color:#fff; border:1px solid #555; border-radius:6px; padding:8px 12px;">Browse...</button>
          </div>
          <p class="note">Tip: If the selected folder lacks a .project file, the app auto-searches up to two subfolders and imports the first CubeIDE project found. You can also import manually in CubeIDE (File ‚Üí Import ‚Üí Existing Projects into Workspace).</p>
        </div>
        <div id="git" style="margin-top:10px; display:none">
          <div class="row">
            <label>Git URL:</label>
            <input id="gitUrl" type="text" placeholder="https://gitlab.com/owner/repo.git" style="flex:1; background:#3a3a3a; color:#fff; border:1px solid #4a4a4a; border-radius:6px; padding:8px 12px;">
          </div>
          <div class="row" style="margin-top:8px">
            <label>Destination Folder:</label>
            <input id="gitDest" type="text" placeholder="Where to clone on your laptop" style="flex:1; background:#3a3a3a; color:#fff; border:1px solid #4a4a4a; border-radius:6px; padding:8px 12px;">
            <button style="background:#444; color:#fff; border:1px solid #555; border-radius:6px; padding:8px 12px;">Select</button>
          </div>
          <p class="note">After cloning, the app attempts to auto-import the project into the workspace using the same detection logic.</p>
        </div>
        <div class="row" style="margin-top:12px; justify-content:flex-end; gap:8px">
          <button id="okBtn" disabled style="opacity:.6; cursor:not-allowed; background:#3b82f6; color:#fff; border:0; border-radius:6px; padding:8px 14px;">OK</button>
          <button id="cancelBtn" style="background:#444; color:#fff; border:1px solid #555; border-radius:6px; padding:8px 12px;">Cancel</button>
        </div>
        <div id="progressCard" class="card" style="margin-top:12px; display:none">
          <h4 style="margin-top:0">Cloning Progress</h4>
          <pre id="log" style="background:#111; color:#ddd; padding:12px; border-radius:6px; max-height:160px; overflow:auto;">Running: git clone ...</pre>
          <div class="row" style="justify-content:flex-end;">
            <button id="cancelClone" style="background:#b91c1c; color:#fff; border:0; border-radius:6px; padding:8px 12px;">Cancel Clone</button>
          </div>
        </div>
        <script>
          const modes = document.querySelectorAll('input[name="mode"]');
          const local = document.getElementById('local');
          const git = document.getElementById('git');
          const okBtn = document.getElementById('okBtn');
          const localPath = document.getElementById('localPath');
          const gitUrl = document.getElementById('gitUrl');
          const gitDest = document.getElementById('gitDest');
          const progressCard = document.getElementById('progressCard');
          const log = document.getElementById('log');
          function validGit(u){ return /^https:\/\/.+\.git$/.test(u) || u.startsWith('git@'); }
          modes.forEach(m => m.addEventListener('change', () => {
            if (m.value === 'local' && m.checked) {
              local.style.display = 'block';
              git.style.display = 'none';
              okBtn.disabled = !(localPath.value.trim());
              okBtn.style.opacity = okBtn.disabled ? .6 : 1;
            } else if (m.value === 'git' && m.checked) {
              local.style.display = 'none';
              git.style.display = 'block';
              okBtn.disabled = !(validGit(gitUrl.value.trim()) && gitDest.value.trim());
              okBtn.style.opacity = okBtn.disabled ? .6 : 1;
            }
          }));
          [localPath, gitUrl, gitDest].forEach(inp => inp.addEventListener('input', () => {
            const mode = document.querySelector('input[name="mode"]:checked').value;
            if (mode === 'local') {
              okBtn.disabled = !(localPath.value.trim());
            } else {
              okBtn.disabled = !(validGit(gitUrl.value.trim()) && gitDest.value.trim());
            }
            okBtn.style.opacity = okBtn.disabled ? .6 : 1;
          }));
          okBtn.addEventListener('click', () => {
            const mode = document.querySelector('input[name="mode"]:checked').value;
            if (mode === 'git') {
              progressCard.style.display = 'block';
              log.textContent = 'Running: git clone '+gitUrl.value+' '+gitDest.value+"\n";
              let i=0; const lines=['Cloning into \''+gitDest.value+'\'...','Receiving objects: 42% (123/291)','Resolving deltas: 68%','Checking out files'];
              const t = setInterval(()=>{ if(i<lines.length){ log.textContent += lines[i++]+'\n'; log.scrollTop=log.scrollHeight; } else { clearInterval(t); log.textContent += 'Clone completed.'; } }, 700);
              document.getElementById('cancelClone').onclick = ()=>{ clearInterval(t); log.textContent += '\nClone cancelled.'; };
            }
          });
        </script>
      </div>

      <div class="card">
        <h3 style="margin-top:0">OneDrive Configuration (Preview)</h3>
        <div id="odBanner" class="banner banner-info">OneDrive enabled: please test and save settings</div>

        <div class="row" style="margin-top:8px">
          <label><input type="checkbox" id="odEnabled"> Enable OneDrive Integration</label>
        </div>

        <div style="margin-top:10px">
          <label>OneDrive Shared Folder Path:</label>
          <div class="row" style="margin-top:6px">
            <input id="odPath" type="text" placeholder="e.g., C:\\Users\\Username\\OneDrive\\SharedFolder" style="flex:1; background:#3a3a3a; color:#fff; border:1px solid #4a4a4a; border-radius:6px; padding:8px 12px;">
            <button id="odDetect" style="background:#444; color:#fff; border:1px solid #555; border-radius:6px; padding:8px 12px;">Detect</button>
            <button id="odBrowse" style="background:#444; color:#fff; border:1px solid #555; border-radius:6px; padding:8px 12px;">Browse</button>
            <button id="odOpen" style="background:#444; color:#fff; border:1px solid #555; border-radius:6px; padding:8px 12px;">Open</button>
          </div>
          <div id="odPathError" class="error"></div>
        </div>

        <div style="margin-top:10px">
          <label>User Folder Name:</label>
          <input id="odUser" type="text" placeholder="e.g., JohnDoe_Work" style="width:100%; background:#3a3a3a; color:#fff; border:1px solid #4a4a4a; border-radius:6px; padding:8px 12px; margin-top:6px;">
          <div id="odUserError" class="error"></div>
        </div>

        <div style="margin-top:10px">
          <label><input type="checkbox" id="odAutoCreate" checked> Automatically create folder structure</label><br>
          <label><input type="checkbox" id="odSync" checked> Enable automatic sync</label>
        </div>

        <div style="margin-top:10px">
          <button id="odTest" style="background:#3b82f6; color:#fff; border:0; border-radius:6px; padding:8px 14px;">Test OneDrive Connection</button>
          <div id="odTestResult" class="callout" style="margin-top:8px">Click 'Test Connection' to verify OneDrive access</div>
        </div>

        <div class="row" style="margin-top:12px; justify-content:flex-end; gap:8px">
          <button id="odSave" disabled style="opacity:.6; cursor:not-allowed; background:#10b981; color:#fff; border:0; border-radius:6px; padding:8px 14px;">Save Settings</button>
        </div>

        <script>
          const odEnabled = document.getElementById('odEnabled');
          const odPath = document.getElementById('odPath');
          const odUser = document.getElementById('odUser');
          const odAutoCreate = document.getElementById('odAutoCreate');
          const odSync = document.getElementById('odSync');
          const odDetect = document.getElementById('odDetect');
          const odBrowse = document.getElementById('odBrowse');
          const odOpen = document.getElementById('odOpen');
          const odTest = document.getElementById('odTest');
          const odSave = document.getElementById('odSave');
          const odPathError = document.getElementById('odPathError');
          const odUserError = document.getElementById('odUserError');
          const odBanner = document.getElementById('odBanner');
          const odTestResult = document.getElementById('odTestResult');

          function setBanner(type, text){ odBanner.className = `banner banner-${type}`; odBanner.textContent = text; }
          function validate(){
            const enabled = odEnabled.checked;
            let pathOk = true, userOk = true;
            odPathError.textContent = ''; odUserError.textContent = '';
            if (enabled){
              const path = odPath.value.trim();
              const user = odUser.value.trim();
              if (!path){ odPathError.textContent = 'Please provide a OneDrive folder path.'; pathOk = false; }
              if (!user){ odUserError.textContent = 'Please provide a user folder name.'; userOk = false; }
              else if (/[\\/:*?"<>|]/.test(user)){ odUserError.textContent = 'User folder name contains invalid characters.'; userOk = false; }
            }
            odSave.disabled = !( (!enabled) || (pathOk && userOk) );
            odSave.style.opacity = odSave.disabled ? .6 : 1;
            if (!enabled) setBanner('warn','OneDrive is currently disabled');
            else if (pathOk && userOk) setBanner('success','OneDrive ready: configuration looks valid');
            else setBanner('error','OneDrive misconfigured: please fix highlighted fields');
          }

          odDetect.addEventListener('click', ()=>{ const p='C:/Users/John/OneDrive/SharedFolder'; odPath.value=p; alert('Detected OneDrive folder: '+p); validate(); });
          odBrowse.addEventListener('click', ()=>{ const p='D:/OneDrive/SharedFolder'; odPath.value=p; validate(); });
          odOpen.addEventListener('click', ()=>{ const p=odPath.value.trim(); if(p) alert('Would open in Explorer: '+p); });
          odTest.addEventListener('click', ()=>{
            const enabled = odEnabled.checked; const path = odPath.value.trim(); const user = odUser.value.trim();
            if (!enabled){ odTestResult.textContent='[ERROR] OneDrive integration is disabled'; odTestResult.className='callout callout-error'; setBanner('warn','OneDrive is currently disabled'); return; }
            if (!path || !user || /[\\/:*?"<>|]/.test(user)){ odTestResult.textContent='[ERROR] Invalid configuration ‚Äî fix inputs and retry'; odTestResult.className='callout callout-error'; setBanner('error','Connection failed'); return; }
            odTestResult.textContent='[SUCCESS] OneDrive folder is reachable (simulated)'; odTestResult.className='callout callout-success'; setBanner('success','OneDrive connected');
          });
          odSave.addEventListener('click', ()=>{ alert('Settings saved'); setBanner('info','Settings updated'); });
          odEnabled.addEventListener('change', validate);
          odPath.addEventListener('input', validate);
          odUser.addEventListener('input', validate);
          validate();
        </script>
      </div>
    </main>
    <style>
      .banner{ padding:10px; border:1px solid; border-radius:6px; }
      .banner-info{ background:#1f2d3a; border-color:#3a5268; color:#9ecae1; }
      .banner-success{ background:#1d3227; border-color:#2e7d32; color:#a7d7b9; }
      .banner-warn{ background:#3b2f1a; border-color:#b08b2e; color:#f0d48a; }
      .banner-error{ background:#3a1f1f; border-color:#c62828; color:#f0a7a7; }
      .error{ color:#f0a7a7; font-size:12px; }
      .callout{ padding:10px; border:1px solid #4a4a4a; border-radius:6px; font-size:12px; }
      .callout-success{ background:#1d3227; color:#a7d7b9; border-color:#2e7d32; }
      .callout-error{ background:#3a1f1f; color:#f0a7a7; border-color:#c62828; }
    </style>
  </body>
</html>